
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" />
  
  <!-- Licensed under the Apache 2.0 License -->
  <link rel="stylesheet" type="text/css" href="../_static/fonts/open-sans/stylesheet.css" />
  <!-- Licensed under the SIL Open Font License -->
  <link rel="stylesheet" type="text/css" href="../_static/fonts/source-serif-pro/source-serif-pro.css" />
  <link rel="stylesheet" type="text/css" href="../_static/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="../_static/css/bootstrap-theme.min.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
    <title>Feature Interaction Constraints &#8212; xgboost 1.0.0-SNAPSHOT documentation</title>
    <link rel="stylesheet" href="../_static/guzzle.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="https://assets.readthedocs.org/static/css/badge_only.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script type="text/javascript" src="https://assets.readthedocs.org/static/javascript/readthedocs-doc-embed.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Text Input Format of DMatrix" href="input_format.html" />
    <link rel="prev" title="Random Forests in XGBoost" href="rf.html" />
  
   

  
<!-- RTD Extra Head -->

<!-- 
Always link to the latest version, as canonical.
http://docs.readthedocs.org/en/latest/canonical.html
-->
<link rel="canonical" href="feature_interaction_constraint.html" />

<link rel="stylesheet" href="https://assets.readthedocs.org/static/css/readthedocs-doc-embed.css" type="text/css" />

<script type="text/javascript" src="../_static/readthedocs-data.js"></script>

<!-- Add page-specific data, which must exist in the page js, not global -->
<script type="text/javascript">
READTHEDOCS_DATA['page'] = "tutorials/feature_interaction_constraint"
READTHEDOCS_DATA['source_suffix'] = ".rst"
</script>

<script type="text/javascript" src="https://assets.readthedocs.org/static/javascript/readthedocs-analytics.js"></script>

<!-- end RTD <extrahead> -->
</head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="input_format.html" title="Text Input Format of DMatrix"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="rf.html" title="Random Forests in XGBoost"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">xgboost 1.0.0-SNAPSHOT documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">XGBoost Tutorials</a> &#187;</li> 
      </ul>
    </div>
    <div class="container-wrapper">

      <div id="mobile-toggle">
        <a href="feature_interaction_constraint.html#"><span class="glyphicon glyphicon-align-justify" aria-hidden="true"></span></a>
      </div>
  <div id="left-column">
    <div class="sphinxsidebar"><a href="../index.html" class="text-logo">XGBoost</a>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <h2>Table Of Contents</h2>
  </div>
  <div class="sidebar-toc">
    
    
      <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../build.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../get_started.html">Get Started with XGBoost</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">XGBoost Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="model.html">Introduction to Boosted Trees</a></li>
<li class="toctree-l2"><a class="reference internal" href="aws_yarn.html">Distributed XGBoost with AWS YARN</a></li>
<li class="toctree-l2"><a class="reference internal" href="kubernetes.html">Distributed XGBoost with Kubernetes</a></li>
<li class="toctree-l2"><a class="reference external" href="../jvm/xgboost4j_spark_tutorial.html">Distributed XGBoost with XGBoost4J-Spark</a></li>
<li class="toctree-l2"><a class="reference internal" href="dart.html">DART booster</a></li>
<li class="toctree-l2"><a class="reference internal" href="monotonic.html">Monotonic Constraints</a></li>
<li class="toctree-l2"><a class="reference internal" href="rf.html">Random Forests in XGBoost</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="feature_interaction_constraint.html#">Feature Interaction Constraints</a></li>
<li class="toctree-l2"><a class="reference internal" href="input_format.html">Text Input Format of DMatrix</a></li>
<li class="toctree-l2"><a class="reference internal" href="param_tuning.html">Notes on Parameter Tuning</a></li>
<li class="toctree-l2"><a class="reference internal" href="external_memory.html">Using XGBoost External Memory Version (beta)</a></li>
<li class="toctree-l2"><a class="reference internal" href="custom_metric_obj.html">Custom Objective and Evaluation Metric</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference external" href="https://discuss.xgboost.ai">XGBoost User Forum</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu/index.html">GPU support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parameter.html">XGBoost Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python/index.html">Python package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../R-package/index.html">R package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jvm/index.html">JVM package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../julia.html">Julia package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli.html">CLI interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contrib/index.html">Contribute to XGBoost</a></li>
</ul>

    
  </div>
</div>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <div id="main-search">
      <form class="form-inline" action="../search.html" method="GET" role="form">
        <div class="input-group">
          <input name="q" type="text" class="form-control" placeholder="Search...">
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div>
      
    </div>
  </div>
        <div id="right-column">
          
          <div role="navigation" aria-label="breadcrumbs navigation">
            <ol class="breadcrumb">
              <li><a href="../index.html">Docs</a></li>
              
                <li><a href="index.html">XGBoost Tutorials</a></li>
              
              <li>Feature Interaction Constraints</li>
            </ol>
          </div>
          
          <div class="document clearer body">
            
  <div class="section" id="feature-interaction-constraints">
<h1>Feature Interaction Constraints<a class="headerlink" href="feature_interaction_constraint.html#feature-interaction-constraints" title="Permalink to this headline">¶</a></h1>
<p>The decision tree is a powerful tool to discover interaction among independent
variables (features). Variables that appear together in a traversal path
are interacting with one another, since the condition of a child node is
predicated on the condition of the parent node. For example, the highlighted
red path in the diagram below contains three variables: <span class="math notranslate nohighlight">\(x_1\)</span>, <span class="math notranslate nohighlight">\(x_7\)</span>,
and <span class="math notranslate nohighlight">\(x_{10}\)</span>, so the highlighted prediction (at the highlighted leaf node)
is the product of interaction between <span class="math notranslate nohighlight">\(x_1\)</span>, <span class="math notranslate nohighlight">\(x_7\)</span>, and
<span class="math notranslate nohighlight">\(x_{10}\)</span>.</p>
<p>
<img src="../_static/feature_interaction_illustration1.svg"
  onerror="this.src='../_static/feature_interaction_illustration1.png'; this.onerror=null;">
</p><p>When the tree depth is larger than one, many variables interact on
the sole basis of minimizing training loss, and the resulting decision tree may
capture a spurious relationship (noise) rather than a legitimate relationship
that generalizes across different datasets. <strong>Feature interaction constraints</strong>
allow users to decide which variables are allowed to interact and which are not.</p>
<p>Potential benefits include:</p>
<ul class="simple">
<li><p>Better predictive performance from focusing on interactions that work –
whether through domain specific knowledge or algorithms that rank interactions</p></li>
<li><p>Less noise in predictions; better generalization</p></li>
<li><p>More control to the user on what the model can fit. For example, the user may
want to exclude some interactions even if they perform well due to regulatory
constraints</p></li>
</ul>
<div class="section" id="a-simple-example">
<h2>A Simple Example<a class="headerlink" href="feature_interaction_constraint.html#a-simple-example" title="Permalink to this headline">¶</a></h2>
<p>Feature interaction constraints are expressed in terms of groups of variables
that are allowed to interact. For example, the constraint
<code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">1]</span></code> indicates that variables <span class="math notranslate nohighlight">\(x_0\)</span> and <span class="math notranslate nohighlight">\(x_1\)</span> are allowed to
interact with each other but with no other variable. Similarly, <code class="docutils literal notranslate"><span class="pre">[2,</span> <span class="pre">3,</span> <span class="pre">4]</span></code>
indicates that <span class="math notranslate nohighlight">\(x_2\)</span>, <span class="math notranslate nohighlight">\(x_3\)</span>, and <span class="math notranslate nohighlight">\(x_4\)</span> are allowed to
interact with one another but with no other variable. A set of feature
interaction constraints is expressed as a nested list, e.g.
<code class="docutils literal notranslate"><span class="pre">[[0,</span> <span class="pre">1],</span> <span class="pre">[2,</span> <span class="pre">3,</span> <span class="pre">4]]</span></code>, where each inner list is a group of indices of features
that are allowed to interact with each other.</p>
<p>In the following diagram, the left decision tree is in violation of the first
constraint (<code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">1]</span></code>), whereas the right decision tree complies with both the
first and second constraints (<code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">1]</span></code>, <code class="docutils literal notranslate"><span class="pre">[2,</span> <span class="pre">3,</span> <span class="pre">4]</span></code>).</p>
<p>
<img src="../_static/feature_interaction_illustration2.svg"
     onerror="this.src='../_static/feature_interaction_illustration2.png'; this.onerror=null;">
<img src="../_static/feature_interaction_illustration3.svg"
     onerror="this.src='../_static/feature_interaction_illustration3.png'; this.onerror=null;">
</p></div>
<div class="section" id="enforcing-feature-interaction-constraints-in-xgboost">
<h2>Enforcing Feature Interaction Constraints in XGBoost<a class="headerlink" href="feature_interaction_constraint.html#enforcing-feature-interaction-constraints-in-xgboost" title="Permalink to this headline">¶</a></h2>
<p>It is very simple to enforce feature interaction constraints in XGBoost.  Here we will
give an example using Python, but the same general idea generalizes to other
platforms.</p>
<p>Suppose the following code fits your model without feature interaction constraints:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model_no_constraints</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">dtrain</span><span class="p">,</span>
                                 <span class="n">num_boost_round</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">evals</span> <span class="o">=</span> <span class="n">evallist</span><span class="p">,</span>
                                 <span class="n">early_stopping_rounds</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p>Then fitting with feature interaction constraints only requires adding a single
parameter:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">params_constrained</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="c1"># Use nested list to define feature interaction constraints</span>
<span class="n">params_constrained</span><span class="p">[</span><span class="s1">&#39;interaction_constraints&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;[[0, 2], [1, 3, 4], [5, 6]]&#39;</span>
<span class="c1"># Features 0 and 2 are allowed to interact with each other but with no other feature</span>
<span class="c1"># Features 1, 3, 4 are allowed to interact with one another but with no other feature</span>
<span class="c1"># Features 5 and 6 are allowed to interact with each other but with no other feature</span>

<span class="n">model_with_constraints</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">params_constrained</span><span class="p">,</span> <span class="n">dtrain</span><span class="p">,</span>
                                   <span class="n">num_boost_round</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">evals</span> <span class="o">=</span> <span class="n">evallist</span><span class="p">,</span>
                                   <span class="n">early_stopping_rounds</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Choice of tree construction algorithm</strong>. To use feature interaction constraints, be sure
to set the <code class="docutils literal notranslate"><span class="pre">tree_method</span></code> parameter to one of the following: <code class="docutils literal notranslate"><span class="pre">exact</span></code>, <code class="docutils literal notranslate"><span class="pre">hist</span></code> or
<code class="docutils literal notranslate"><span class="pre">gpu_hist</span></code>.  Support for <code class="docutils literal notranslate"><span class="pre">gpu_hist</span></code> is added after (excluding) version 0.90.</p>
</div>
<div class="section" id="advanced-topic">
<h2>Advanced topic<a class="headerlink" href="feature_interaction_constraint.html#advanced-topic" title="Permalink to this headline">¶</a></h2>
<p>The intuition behind interaction constraint is simple.  User have prior knowledge about
relations between different features, and encode it as constraints during model
construction.  But there are also some subtleties around specifying constraints.  Take
constraint <code class="docutils literal notranslate"><span class="pre">[[1,</span> <span class="pre">2],</span> <span class="pre">[2,</span> <span class="pre">3,</span> <span class="pre">4]]</span></code> as an example, the second feature appears in two
different interaction sets <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">2]</span></code> and <code class="docutils literal notranslate"><span class="pre">[2,</span> <span class="pre">3,</span> <span class="pre">4]</span></code>, so the union set of features
allowed to interact with <code class="docutils literal notranslate"><span class="pre">2</span></code> is <code class="docutils literal notranslate"><span class="pre">{1,</span> <span class="pre">3,</span> <span class="pre">4}</span></code>.  In following diagram, root splits at
feature <code class="docutils literal notranslate"><span class="pre">2</span></code>.  because all its descendants should be able to interact with it, so at the
second layer all 4 features are legitimate split candidates for further splitting,
disregarding specified constraint sets.</p>
<div class="figure align-center" id="id1" style="width: 80%">
<img alt="../_images/feature_interaction_illustration4.png" src="../_images/feature_interaction_illustration4.png" />
<p class="caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">{1,</span> <span class="pre">2,</span> <span class="pre">3,</span> <span class="pre">4}</span></code> represents the sets of legitimate split features.</span><a class="headerlink" href="feature_interaction_constraint.html#id1" title="Permalink to this image">¶</a></p>
</div>
<p>This has lead to some interesting implications of feature interaction constraints.  Take
<code class="docutils literal notranslate"><span class="pre">[[0,</span> <span class="pre">1],</span> <span class="pre">[0,</span> <span class="pre">1,</span> <span class="pre">2],</span> <span class="pre">[1,</span> <span class="pre">2]]</span></code> as another example.  Assuming we have only 3 available
features in our training datasets for presentation purpose, careful readers might have
found out that the above constraint is same with <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">1,</span> <span class="pre">2]</span></code>.  Since no matter which
feature is chosen for split in root node, all its descendants have to include every
feature as legitimate split candidates to avoid violating interaction constraints.</p>
<p>For one last example, we use <code class="docutils literal notranslate"><span class="pre">[[0,</span> <span class="pre">1],</span> <span class="pre">[1,</span> <span class="pre">3,</span> <span class="pre">4]]</span></code> and choose feature <code class="docutils literal notranslate"><span class="pre">0</span></code> as split for
root node.  At the second layer of built tree, <code class="docutils literal notranslate"><span class="pre">1</span></code> is the only legitimate split
candidate except for <code class="docutils literal notranslate"><span class="pre">0</span></code> itself, since they belong to the same constraint set.
Following the grow path of our example tree below, the node at second layer splits at
feature <code class="docutils literal notranslate"><span class="pre">1</span></code>.  But due to the fact that <code class="docutils literal notranslate"><span class="pre">1</span></code> also belongs to second constraint set <code class="docutils literal notranslate"><span class="pre">[1,</span>
<span class="pre">3,</span> <span class="pre">4]</span></code>, at third layer, we need to include all features as candidates to comply with its
ascendants.</p>
<div class="figure align-center" id="id2" style="width: 80%">
<img alt="../_images/feature_interaction_illustration6.png" src="../_images/feature_interaction_illustration6.png" />
<p class="caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">{0,</span> <span class="pre">1,</span> <span class="pre">3,</span> <span class="pre">4}</span></code> represents the sets of legitimate split features.</span><a class="headerlink" href="feature_interaction_constraint.html#id2" title="Permalink to this image">¶</a></p>
</div>
</div>
</div>


          </div>
            
  <div class="footer-relations">
    
      <div class="pull-left">
        <a class="btn btn-default" href="rf.html" title="previous chapter (use the left arrow)">Random Forests in XGBoost</a>
      </div>
    
      <div class="pull-right">
        <a class="btn btn-default" href="input_format.html" title="next chapter (use the right arrow)">Text Input Format of DMatrix</a>
      </div>
    </div>
    <div class="clearer"></div>
  
        </div>
        <div class="clearfix"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="input_format.html" title="Text Input Format of DMatrix"
             >next</a> |</li>
        <li class="right" >
          <a href="rf.html" title="Random Forests in XGBoost"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">xgboost 1.0.0-SNAPSHOT documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >XGBoost Tutorials</a> &#187;</li> 
      </ul>
    </div>
<script type="text/javascript">
  $("#mobile-toggle a").click(function () {
    $("#left-column").toggle();
  });
</script>
<script type="text/javascript" src="../_static/js/bootstrap.js"></script>
  <div class="footer">
    &copy; Copyright 2019, xgboost developers. Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div>
  </body>
</html>